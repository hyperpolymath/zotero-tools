# SPDX-License-Identifier: PMPL-1.0-or-later
name: "Policy Check"

on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]

jobs:
  policy:
    name: Hyperpolymath Language Policy
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
    - name: Checkout repository
      uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1

    - name: Run policy check
      run: |
        chmod +x scripts/check-policy.sh
        ./scripts/check-policy.sh

  nickel-validate:
    name: Validate Mustfile
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
    - name: Checkout repository
      uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1

    - name: Install Nickel
      run: |
        curl -L https://github.com/tweag/nickel/releases/latest/download/nickel-x86_64-unknown-linux-musl -o nickel
        chmod +x nickel
        sudo mv nickel /usr/local/bin/

    - name: Validate Mustfile.ncl
      run: |
        nickel typecheck Mustfile.ncl
        nickel export Mustfile.ncl > /dev/null
        echo "âœ“ Mustfile.ncl is valid"
